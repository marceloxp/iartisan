#!/usr/bin/env php
<?php
require __DIR__ . '/../vendor/autoload.php';

use Symfony\Component\Console\Application;
use Symfony\Component\Console\Input\ArrayInput;
use Symfony\Component\Console\Output\ConsoleOutput;
use Marceloxp\Iartisan\Commands\ConfigSetCommand;
use Marceloxp\Iartisan\Commands\AskCommand;
use Marceloxp\Iartisan\Commands\ConfigClearCommand;

$app = new Application('IArtisan', '0.1.0');

$app->add(new ConfigSetCommand());
$app->add(new ConfigClearCommand());
$app->add(new AskCommand());

// Dispatch logic:
// If first arg is 'config:set' or other Symfony commands -> run normally
// Otherwise, join all args and pass as prompt to AskCommand
$args = $argv;
array_shift($args);

if (count($args) === 0) {
    $app->run();
    exit;
}

$first = $args[0];
if ($first === 'config:set' || $first === 'help' || strpos($first, '--') === 0) {
    $app->run();
    exit;
}

$prompt = implode(' ', $args);

// Run the 'ask' command internally
$command = $app->find('ask');
$input = new ArrayInput(['prompt' => $prompt]);
$output = new ConsoleOutput();
$command->run($input, $output);
